6. Player progression and upgrades

Goal: Co-op Isaac / Nuclear Throne style builds where players stay in the same power band without cloning items.

Shared run power curve

- Use a single shared run progression value: `team_rank` (run level).
- `team_rank` increases from global events: rooms cleared, waves survived, bosses killed, core hell-resource collected, etc.
- Enemy stats, spawn intensity, and upgrade tier availability depend on `team_rank`, not per player XP.

Per player rank, locked to the team

- Track `player_rank[player_id]`.
- Invariant: `team_rank - 1 <= player_rank[player_id] <= team_rank`.
- No one can fall more than one tier behind the team.
- When `team_rank` increases, trigger a "tier up" event where each living player chooses an upgrade and their `player_rank` is set to `team_rank`.

Tiered upgrade draft

- Every time `team_rank` increases, pause combat or use an inter-wave phase.
- For each player:
  - Roll 2 to 3 upgrade cards from a pool tagged for that character and tier.
  - Player picks 1, permanently added to their build.
- Tiers:
  - Tier 1: basic stat bumps (damage, hp, speed, ammo, gun handling).
  - Tier 2: identity shaping perks (build-defining modifiers, new behaviors).
  - Tier 3+: big spikes, strong synergies, tradeoffs, weird stuff.
- Power budget per tier should be roughly equal across characters even if the effect is different.

Loot rules that do not wreck pacing

Drop categories:

1. Team pickups
   - Shared currency, keys, hell-ore, relic shards, etc.
   - Auto distribute or apply to the whole team immediately.
   - These mostly feed Borer upgrades and global systems.

2. Choice objects
   - Chests, altars, shrines, reliquaries.
   - Spawn 2 to 4 items at once.
   - Team decides who takes what, everything else disappears on pickup.
   - Forces quick co-op decisions: "who needs the holy shotgun most right now".

3. Role locked drops (optional)
   - Some items are tagged for specific classes.
   - Appears ghosted or cannot be picked up except by the intended class.
   - Prevents nonsense like the healer hoarding all the heavy weapons.

Rubber banding (under the hood)

- Maintain a simple `power_score[player_id]` that factors in weapon rarity, relic count, key upgrades, etc.
- When deciding who a chest or relic is "aimed at", bias the rolls toward the lowest `power_score`.
- Do not expose this. The game just "happens" to slightly favor the weaker player.

Death and respawn rules

- If a player dies and later returns:
  - Set `player_rank[player_id] = max(team_rank - 1, 1)`.
  - Auto grant them generic catch-up perks from earlier tiers so they are not useless.
  - Give them a baseline respectable weapon, not the starter peashooter.
- Optional penalties for tension:
  - Lower max hp for the rest of the run.
  - Fewer rerolls, heals, or revives available to that player.

Implementation order

1. Implement `team_rank` that increases on waves cleared or distance drilled into Hell.
2. Implement tier up events where each player gets 3 draft options from their character pool.
3. Enforce the `player_rank` gap rule and respawn catch-up logic.
4. Only after that, layer in chest logic, role locked drops, and rubber banding.
